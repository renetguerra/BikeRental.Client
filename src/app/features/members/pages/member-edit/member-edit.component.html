@if (!member()) {
  <div class="text-center">
    <div class="spinner-border" role="status">
      <span class="sr-only">Loading...</span>
    </div>
    <p>Loading member data...</p>
  </div>
} @else {
<div class="modern-member-detail">
  <div class="container">
    <div class="max-w-4xl mx-auto">
      <h1 class="page-title">Editar Perfil</h1>

      @if (editForm?.dirty) {
      <div class="alert alert-info mb-4">
        <p>
          <strong>Información: </strong>Has realizado cambios. Cualquier cambio no guardado se perderá.
        </p>
      </div>
      }

      <!-- Tabs Section -->
      <div class="tabs-container">
        <!-- Tab Content -->
        <div class="tab-content">
          <!-- Info Tab -->
            <form #editForm="ngForm" id="editForm" (ngSubmit)="updateMember()">

              <!-- Información Personal Card -->
              <div class="info-card">
                <h2 class="card-title">Información Personal</h2>
                <div class="personal-details">
                  <div class="detail-row">
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Nombre:</span>
                        <input
                          type="text"
                          name="knownAs"
                          class="detail-input"
                          [(ngModel)]="member()!.knownAs"
                          placeholder="Ingresa tu nombre">
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Apellido:</span>
                        <input
                          type="text"
                          name="surname"
                          class="detail-input"
                          [(ngModel)]="member()!.surname"
                          placeholder="Ingresa tu apellido">
                      </div>
                    </div>
                  </div>
                  <div class="detail-row">
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Nombre de usuario:</span>
                        <input
                          type="text"
                          name="username"
                          class="detail-input"
                          [(ngModel)]="member()!.username"
                          placeholder="nombre_usuario">
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Correo electrónico:</span>
                        <input
                          type="email"
                          name="email"
                          class="detail-input"
                          [(ngModel)]="member()!.email"
                          placeholder="tu@email.com">
                      </div>
                    </div>
                  </div>
                  <div class="detail-row detail-row-full">
                    <div class="detail-group detail-group-full">
                      <div class="detail-text">
                        <span class="detail-label">Descripción:</span>
                        <textarea
                          name="introduction"
                          class="detail-input detail-textarea-large"
                          [(ngModel)]="member()!.introduction"
                          placeholder="Cuéntanos algo sobre ti..."
                          rows="4"></textarea>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Botón Save Changes para Información Personal -->
                <div class="card-actions">
                  <button
                    type="button"
                    class="primary-btn"
                    (click)="updatePersonalInfo()"
                    [disabled]="!editForm?.dirty">
                    <mat-icon>save</mat-icon>
                    Guardar Información Personal
                  </button>
                </div>
              </div>

              <!-- Imagen de Perfil Card (Separada) -->
              @if (user()?.username === member()?.username || user()?.roles?.includes('Admin')) {
              <div class="info-card">
                <h2 class="card-title">Imagen de Perfil</h2>
                <div class="profile-upload-section">
                  <div class="profile-avatar">
                    <img
                      [src]="member()?.photoUrl || './assets/user.png'"
                      [alt]="member()?.knownAs"
                      class="avatar-image"/>
                  </div>
                  <div class="upload-controls">
                    <button type="button" class="primary-btn" (click)="openDialogAddPhoto()">
                      <mat-icon>add_a_photo</mat-icon>
                      Seleccionar imagen
                    </button>
                    <p class="upload-hint">PNG, JPG, GIF hasta 10MB.</p>
                  </div>
                </div>
              </div>
              }

              <!-- Detalles de Ubicación Card -->
              <div class="info-card">
                <h3 class="section-title">Detalles de Ubicación</h3>
                <div class="location-details">
                  <div class="detail-row">
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Calle:</span>
                        <input
                          type="text"
                          name="street"
                          class="detail-input"
                          [(ngModel)]="member()!.address!.street"
                          placeholder="Nombre de la calle">
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Número:</span>
                        <input
                          type="text"
                          name="houseNumber"
                          class="detail-input"
                          [(ngModel)]="member()!.address!.houseNumber"
                          placeholder="123">
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Código Postal:</span>
                        <input
                          type="text"
                          name="zip"
                          class="detail-input"
                          [(ngModel)]="member()!.address!.zip"
                          placeholder="12345">
                      </div>
                    </div>
                  </div>
                  <div class="detail-row">
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Ciudad:</span>
                        <input
                          type="text"
                          name="city"
                          class="detail-input"
                          [(ngModel)]="member()!.address!.city"
                          placeholder="Nombre de la ciudad">
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">País:</span>
                        <input
                          type="text"
                          name="country"
                          class="detail-input"
                          [(ngModel)]="member()!.address!.country"
                          placeholder="Nombre del país">
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Botón Confirmar Ubicación -->
                <div class="card-actions">
                  <button
                    type="button"
                    class="primary-btn"
                    (click)="updateLocationInfo()"
                    [disabled]="!editForm?.dirty">
                    <mat-icon>location_on</mat-icon>
                    Confirmar Ubicación
                  </button>
                </div>
              </div>

              <!-- Datos Bancarios Card -->
              <div class="info-card">
                <h3 class="section-title">Datos Bancarios</h3>
                <div class="banking-details">
                  <div class="detail-row">
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Número de tarjeta:</span>
                        <input
                          type="text"
                          name="cardNumber"
                          class="detail-input"
                          [(ngModel)]="member()!.cardNumber"
                          placeholder="1234 5678 9012 3456"
                          maxlength="19">
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Titular de la tarjeta:</span>
                        <input
                          type="text"
                          name="cardholderName"
                          class="detail-input"
                          [(ngModel)]="member()!.cardHolderName"
                          placeholder="Nombre del titular">
                      </div>
                    </div>
                  </div>
                  <div class="detail-row">
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Fecha de vencimiento:</span>
                        <input
                          type="text"
                          name="expiryDate"
                          class="detail-input"
                          [(ngModel)]="member()!.expiryDate"
                          placeholder="MM/YY"
                          maxlength="5">
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Banco:</span>
                        <input
                          type="text"
                          name="bankName"
                          class="detail-input"
                          [(ngModel)]="member()!.bankName"
                          placeholder="Nombre del banco">
                      </div>
                    </div>
                  </div>
                  <div class="detail-row">
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">
                          <mat-icon>credit_card</mat-icon>
                          Número de cuenta:
                        </span>
                        <input
                          type="text"
                          name="accountNumber"
                          class="detail-input"
                          [(ngModel)]="member()!.accountNumber"
                          placeholder="Número de cuenta bancaria">
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Código de ruta:</span>
                        <input
                          type="text"
                          name="routingNumber"
                          class="detail-input"
                          [(ngModel)]="member()!.routingNumber"
                          placeholder="Código de ruta del banco">
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Botón Confirmar Datos Bancarios -->
                <div class="card-actions">
                  <button
                    type="button"
                    class="primary-btn"
                    (click)="updateBankingInfo()"
                    [disabled]="!editForm?.dirty">
                    <mat-icon>account_balance</mat-icon>
                    Confirmar Datos Bancarios
                  </button>
                </div>
              </div>

            </form>
        </div>
      </div>
    </div>
  </div>
</div>
}
