@if (!member()) {
<div class="text-center">
  <div class="spinner-border" role="status">
    <span class="sr-only">Loading...</span>
  </div>
  <p>Loading member data...</p>
</div>
} @else {
<div class="modern-member-detail">
  <div class="container">
    <div class="max-w-4xl mx-auto">
      <h1 class="page-title">Edit Profile</h1>

      @if (editForm?.dirty) {
      <div class="alert alert-info mb-4">
        <p>
          <strong>Info: </strong>You have made changes. Any unsaved changes will
          be lost.
        </p>
      </div>
      }

      <!-- Tabs Section -->
      <div class="tabs-container">
        <!-- Tab Content -->
        <div class="tab-content">
          <!-- Info Tab -->
          <form #editForm="ngForm" id="editForm" (ngSubmit)="updateMember()">
            <!-- Personal Information Card -->
            <div class="info-card">
              <h2 class="card-title">Personal Information</h2>
              <div class="personal-details">
                <div class="detail-row">
                  <div class="detail-group">
                    <div class="detail-text">
                      <span class="detail-label">Name:</span>
                      <input
                        type="text"
                        name="knownAs"
                        class="detail-input"
                        [(ngModel)]="member()!.knownAs"
                        placeholder="Enter your name"
                      />
                    </div>
                  </div>
                  <div class="detail-group">
                    <div class="detail-text">
                      <span class="detail-label">Surname:</span>
                      <input
                        type="text"
                        name="surname"
                        class="detail-input"
                        [(ngModel)]="member()!.surname"
                        placeholder="Enter your surname"
                      />
                    </div>
                  </div>
                </div>
                <div class="detail-row">
                  <div class="detail-group">
                    <div class="detail-text">
                      <span class="detail-label">Username:</span>
                      <input
                        type="text"
                        name="username"
                        class="detail-input"
                        [(ngModel)]="member()!.username"
                        placeholder="username"
                      />
                    </div>
                  </div>
                  <div class="detail-group">
                    <div class="detail-text">
                      <span class="detail-label">Email:</span>
                      <input
                        type="email"
                        name="email"
                        class="detail-input"
                        [(ngModel)]="member()!.email"
                        placeholder="your@email.com"
                      />
                    </div>
                  </div>
                </div>
                <div class="detail-row detail-row-full">
                  <div class="detail-group detail-group-full">
                    <div class="detail-text">
                      <span class="detail-label">Description:</span>
                      <textarea
                        name="introduction"
                        class="detail-input detail-textarea-large"
                        [(ngModel)]="member()!.introduction"
                        placeholder="Tell us something about yourself..."
                        rows="4"
                      ></textarea>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Save Changes Button for Personal Information -->
              <div class="card-actions">
                <button
                  type="button"
                  class="primary-btn"
                  (click)="updatePersonalInfo()"
                  [disabled]="!editForm?.dirty"
                >
                  <mat-icon>save</mat-icon>
                  Save Personal Information
                </button>
              </div>
            </div>

            <!-- Profile Image Card (Separate) -->
            @if (user()?.username === member()?.username ||
            user()?.roles?.includes('Admin')) {
            <div class="info-card">
              <h2 class="card-title">Profile Image</h2>
              <div class="profile-upload-section">
                <div class="profile-avatar">
                  <img
                    [src]="member()?.photoUrl || './assets/user.png'"
                    [alt]="member()?.knownAs"
                    class="avatar-image"
                  />
                </div>
                <div class="upload-controls">
                  <button
                    type="button"
                    class="primary-btn"
                    (click)="openDialogAddPhoto()"
                  >
                    <mat-icon>add_a_photo</mat-icon>
                    Select image
                  </button>
                  <p class="upload-hint">PNG, JPG, GIF up to 10MB.</p>
                </div>
              </div>
            </div>
            }

            <!-- Location Details Card -->
            <div class="info-card">
              <h3 class="section-title">Location Details</h3>
              @if (member() && !member()!.address) {
                <div class="alert alert-warning">
                  <p>No location info available.</p>
                </div>
              }
              <div class="location-details">
                @if (member() && member()!.address) {
                  <div class="detail-row">
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Street:</span>
                        <input
                          type="text"
                          name="street"
                          class="detail-input"
                          [(ngModel)]="member()!.address.street"
                          placeholder="Street name"
                        />
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">House Number:</span>
                        <input
                          type="text"
                          name="houseNumber"
                          class="detail-input"
                          [(ngModel)]="member()!.address.houseNumber"
                          placeholder="123"
                        />
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Postal Code:</span>
                        <input
                          type="text"
                          name="zip"
                          class="detail-input"
                          [(ngModel)]="member()!.address.zip"
                          placeholder="12345"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="detail-row">
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">City:</span>
                        <input
                          type="text"
                          name="city"
                          class="detail-input"
                          [(ngModel)]="member()!.address.city"
                          placeholder="City name"
                        />
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Country:</span>
                        <input
                          type="text"
                          name="country"
                          class="detail-input"
                          [(ngModel)]="member()!.address.country"
                          placeholder="Country name"
                        />
                      </div>
                    </div>
                  </div>
                }
              </div>

              <!-- Confirm Location Button -->
              <div class="card-actions">
                <button
                  type="button"
                  class="primary-btn"
                  (click)="updateLocationInfo()"
                  [disabled]="!editForm?.dirty"
                >
                  <mat-icon>location_on</mat-icon>
                  Confirm Location
                </button>
              </div>
            </div>

            <!-- Banking Details Card -->
            <div class="info-card">
              <h3 class="section-title">Banking Details</h3>
              @if (member() && !member()!.bankAccount) {
                <div class="alert alert-warning">
                  <p>No bank account info available.</p>
                </div>
              }
              <div class="banking-details">
                @if (member() && member()!.bankAccount) {
                  <div class="detail-row">
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Card Number:</span>
                        <input
                          type="text"
                          name="cardNumber"
                          class="detail-input"
                          [(ngModel)]="member()!.bankAccount.cardNumber"
                          placeholder="1234 5678 9012 3456"
                          maxlength="19"
                        />
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Cardholder Name:</span>
                        <input
                          type="text"
                          name="cardholderName"
                          class="detail-input"
                          [(ngModel)]="member()!.bankAccount.cardHolderName"
                          placeholder="Cardholder name"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="detail-row">
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Expiry Date:</span>
                        <input
                          type="text"
                          name="expiryDate"
                          class="detail-input"
                          [(ngModel)]="member()!.bankAccount.expiryDate"
                          placeholder="MM/YY"
                          maxlength="5"
                        />
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Bank Name:</span>
                        <input
                          type="text"
                          name="bankName"
                          class="detail-input"
                          [(ngModel)]="member()!.bankAccount.bankName"
                          placeholder="Bank name"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="detail-row">
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">
                          <mat-icon>credit_card</mat-icon>
                          Account Number:
                        </span>
                        <input
                          type="text"
                          name="accountNumber"
                          class="detail-input"
                          [(ngModel)]="member()!.bankAccount.accountNumber"
                          placeholder="Bank account number"
                        />
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">Routing Number:</span>
                        <input
                          type="text"
                          name="routingNumber"
                          class="detail-input"
                          [(ngModel)]="member()!.bankAccount.routingNumber"
                          placeholder="Bank routing code"
                        />
                      </div>
                    </div>
                  </div>
                }
              </div>

              <!-- Confirm Banking Info Button -->
              <div class="card-actions">
                <button
                  type="button"
                  class="primary-btn"
                  (click)="updateBankingInfo()"
                  [disabled]="!editForm?.dirty"
                >
                  <mat-icon>account_balance</mat-icon>
                  Confirm Banking Info
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
}
