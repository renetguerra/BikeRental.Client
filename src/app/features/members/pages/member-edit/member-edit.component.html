@if (!member()) {
<div class="text-center">
  <div class="spinner-border" role="status">
    <span class="sr-only">Loading...</span>
  </div>
  <p>Loading member data...</p>
</div>
} @else {
<div class="modern-member-detail">
  <div class="container">
    <div class="max-w-4xl mx-auto">
  <h1 class="page-title">{{ 'memberEdit.title' | transloco }}</h1>

      @if (editForm?.dirty) {
      <div class="alert alert-info mb-4">
        <p>
          <strong>{{ 'memberEdit.info' | transloco }}</strong>{{ 'memberEdit.unsavedChanges' | transloco }}
        </p>
      </div>
      }

      <!-- Tabs Section -->
      <div class="tabs-container">
        <!-- Tab Content -->
        <div class="tab-content">
          <!-- Info Tab -->
          <form #editForm="ngForm" id="editForm" (ngSubmit)="updateMember()">
            <!-- Personal Information Card -->
            <div class="info-card">
              <h2 class="card-title">{{ 'memberEdit.personalInfo' | transloco }}</h2>
              <div class="personal-details">
                <div class="detail-row">
                  <div class="detail-group">
                    <div class="detail-text">
                      <span class="detail-label">{{ 'memberEdit.name' | transloco }}:</span>
                      <input
                        type="text"
                        name="knownAs"
                        class="detail-input"
                        [(ngModel)]="member()!.knownAs"
                        [placeholder]="('memberEdit.enterName' | transloco)"
                      />
                    </div>
                  </div>
                  <div class="detail-group">
                    <div class="detail-text">
                      <span class="detail-label">{{ 'memberEdit.surname' | transloco }}:</span>
                      <input
                        type="text"
                        name="surname"
                        class="detail-input"
                        [(ngModel)]="member()!.surname"
                        [placeholder]="('memberEdit.enterSurname' | transloco)"
                      />
                    </div>
                  </div>
                </div>
                <div class="detail-row">
                  <div class="detail-group">
                    <div class="detail-text">
                      <span class="detail-label">{{ 'memberEdit.username' | transloco }}:</span>
                      <input
                        type="text"
                        name="username"
                        class="detail-input"
                        [(ngModel)]="member()!.username"
                        [placeholder]="('memberEdit.enterUsername' | transloco)"
                      />
                    </div>
                  </div>
                  <div class="detail-group">
                    <div class="detail-text">
                      <span class="detail-label">{{ 'memberEdit.email' | transloco }}:</span>
                      <input
                        type="email"
                        name="email"
                        class="detail-input"
                        [(ngModel)]="member()!.email"
                        [placeholder]="('memberEdit.enterEmail' | transloco)"
                      />
                    </div>
                  </div>
                </div>
                <div class="detail-row detail-row-full">
                  <div class="detail-group detail-group-full">
                    <div class="detail-text">
                      <span class="detail-label">{{ 'memberEdit.description' | transloco }}:</span>
                      <textarea
                        name="introduction"
                        class="detail-input detail-textarea-large"
                        [(ngModel)]="member()!.introduction"
                        [placeholder]="('memberEdit.tellAbout' | transloco)"
                        rows="4"
                      ></textarea>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Save Changes Button for Personal Information -->
              <div class="card-actions">
                <button
                  type="button"
                  class="primary-btn"
                  (click)="updatePersonalInfo()"
                  [disabled]="!editForm?.dirty"
                >
                  <mat-icon>save</mat-icon>
                  {{ 'memberEdit.savePersonalInfo' | transloco }}
                </button>
              </div>
            </div>

            <!-- Profile Image Card (Separate) -->
            @if (user()?.username === member()?.username ||
            user()?.roles?.includes('Admin')) {
            <div class="info-card">
              <h2 class="card-title">{{ 'memberEdit.profileImage' | transloco }}</h2>
              <div class="profile-upload-section">
                <div class="profile-avatar">
                  <img
                    [src]="member()?.photoUrl || './assets/user.png'"
                    [alt]="member()?.knownAs"
                    class="avatar-image"
                  />
                </div>
                <div class="upload-controls">
                  <button
                    type="button"
                    class="primary-btn"
                    (click)="openDialogAddPhoto()"
                  >
                    <mat-icon>add_a_photo</mat-icon>
                    {{ 'memberEdit.selectImage' | transloco }}
                  </button>
                  <p class="upload-hint">{{ 'memberEdit.uploadHint' | transloco }}</p>
                </div>
              </div>
            </div>
            }

            <!-- Location Details Card -->
            <div class="info-card">
              <h3 class="section-title">{{ 'memberEdit.locationDetails' | transloco }}</h3>
              @if (member() && !member()!.address) {
                <div class="alert alert-warning">
                  <p>{{ 'memberEdit.noLocation' | transloco }}</p>
                </div>
              }
              <div class="location-details">
                @if (member() && member()!.address) {
                  <div class="detail-row">
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">{{ 'memberEdit.street' | transloco }}:</span>
                        <input
                          type="text"
                          name="street"
                          class="detail-input"
                          [(ngModel)]="member()!.address.street"
                          [placeholder]="('memberEdit.street' | transloco)"
                        />
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">{{ 'memberEdit.houseNumber' | transloco }}:</span>
                        <input
                          type="text"
                          name="houseNumber"
                          class="detail-input"
                          [(ngModel)]="member()!.address.houseNumber"
                          [placeholder]="('memberEdit.houseNumber' | transloco)"
                        />
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">{{ 'memberEdit.postalCode' | transloco }}:</span>
                        <input
                          type="text"
                          name="zip"
                          class="detail-input"
                          [(ngModel)]="member()!.address.zip"
                          [placeholder]="('memberEdit.postalCode' | transloco)"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="detail-row">
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">{{ 'memberEdit.city' | transloco }}:</span>
                        <input
                          type="text"
                          name="city"
                          class="detail-input"
                          [(ngModel)]="member()!.address.city"
                          [placeholder]="('memberEdit.city' | transloco)"
                        />
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">{{ 'memberEdit.country' | transloco }}:</span>
                        <input
                          type="text"
                          name="country"
                          class="detail-input"
                          [(ngModel)]="member()!.address.country"
                          [placeholder]="('memberEdit.country' | transloco)"
                        />
                      </div>
                    </div>
                  </div>
                }
              </div>

              <!-- Confirm Location Button -->
              <div class="card-actions">
                <button
                  type="button"
                  class="primary-btn"
                  (click)="updateLocationInfo()"
                  [disabled]="!editForm?.dirty"
                >
                  <mat-icon>location_on</mat-icon>
                  {{ 'memberEdit.confirmLocation' | transloco }}
                </button>
              </div>
            </div>

            <!-- Banking Details Card -->
            <div class="info-card">
              <h3 class="section-title">{{ 'memberEdit.bankingDetails' | transloco }}</h3>
              @if (member() && !member()!.bankAccount) {
                <div class="alert alert-warning">
                  <p>{{ 'memberEdit.noBank' | transloco }}</p>
                </div>
              }
              <div class="banking-details">
                @if (member() && member()!.bankAccount) {
                  <div class="detail-row">
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">{{ 'memberEdit.cardNumber' | transloco }}:</span>
                        <input
                          type="text"
                          name="cardNumber"
                          class="detail-input"
                          [(ngModel)]="member()!.bankAccount.cardNumber"
                          [placeholder]="('memberEdit.cardNumber' | transloco)"
                          maxlength="19"
                        />
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">{{ 'memberEdit.cardholderName' | transloco }}:</span>
                        <input
                          type="text"
                          name="cardholderName"
                          class="detail-input"
                          [(ngModel)]="member()!.bankAccount.cardHolderName"
                          [placeholder]="('memberEdit.cardholderName' | transloco)"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="detail-row">
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">{{ 'memberEdit.expiryDate' | transloco }}:</span>
                        <input
                          type="text"
                          name="expiryDate"
                          class="detail-input"
                          [(ngModel)]="member()!.bankAccount.expiryDate"
                          [placeholder]="('memberEdit.expiryDate' | transloco)"
                          maxlength="5"
                        />
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">{{ 'memberEdit.bankName' | transloco }}:</span>
                        <input
                          type="text"
                          name="bankName"
                          class="detail-input"
                          [(ngModel)]="member()!.bankAccount.bankName"
                          [placeholder]="('memberEdit.bankName' | transloco)"
                        />
                      </div>
                    </div>
                  </div>
                  <div class="detail-row">
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">
                          <mat-icon>credit_card</mat-icon>
                          {{ 'memberEdit.accountNumber' | transloco }}:
                        </span>
                        <input
                          type="text"
                          name="accountNumber"
                          class="detail-input"
                          [(ngModel)]="member()!.bankAccount.accountNumber"
                          [placeholder]="('memberEdit.accountNumber' | transloco)"
                        />
                      </div>
                    </div>
                    <div class="detail-group">
                      <div class="detail-text">
                        <span class="detail-label">{{ 'memberEdit.routingNumber' | transloco }}:</span>
                        <input
                          type="text"
                          name="routingNumber"
                          class="detail-input"
                          [(ngModel)]="member()!.bankAccount.routingNumber"
                          [placeholder]="('memberEdit.routingNumber' | transloco)"
                        />
                      </div>
                    </div>
                  </div>
                }
              </div>

              <!-- Confirm Banking Info Button -->
              <div class="card-actions">
                <button
                  type="button"
                  class="primary-btn"
                  (click)="updateBankingInfo()"
                  [disabled]="!editForm?.dirty"
                >
                  <mat-icon>account_balance</mat-icon>
                  {{ 'memberEdit.confirmBanking' | transloco }}
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
}
