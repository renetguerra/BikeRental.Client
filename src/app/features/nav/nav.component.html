<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-primary">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" routerLink="/" routerLinkActive="active">
      <img src="./assets/logos/logo_br.png" alt="Logo" class="logo" (error)="onImgError($event, '/assets/logos/logo_br.png')" />
      BIKE Rental App
    </a>
    <button class="navbar-toggler" type="button" (click)="isCollapsed = !isCollapsed">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div [collapse]="isCollapsed" class="collapse navbar-collapse" id="navbarMain">
      <ul class="navbar-nav mx-auto mb-2 mb-md-0">
        @if (user()) {
          <ng-container>
            <li class="nav-item">
                <a class="nav-link" [routerLink]="['/member', user()?.username]"  routerLinkActive="active">{{ 'nav.profile' | transloco }}</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" routerLink="/bikes" routerLinkActive="active">{{ 'nav.bikes' | transloco }}</a>
            </li>
            <li *appHasRole="['Admin', 'Moderator']" class="nav-item">
                <a class="nav-link" routerLink="/members" routerLinkActive="active">{{ 'nav.customers' | transloco }}</a>
            </li>
            <li *appHasRole="['Admin', 'Moderator']" class="nav-item dropdown" dropdown>
              <a class="nav-link dropdown-toggle" id="adminMenu" role="button" data-bs-toggle="dropdown"
                aria-expanded="false" dropdownToggle>
                  {{ 'nav.admin' | transloco }}
              </a>
              <ul class="dropdown-menu bg-primary" aria-labelledby="adminMenu" *dropdownMenu>
                  <li><a class="dropdown-item ps-3" routerLink="/admin">{{ 'nav.customers' | transloco }}</a></li>
                  <li><a class="dropdown-item ps-3" routerLink="/admin-bike">{{ 'nav.bikes' | transloco }}</a></li>
              </ul>
            </li>
          </ng-container>
        }
      </ul>

      <!-- Search Bar -->
      @if (user()) {
        <div class="d-flex me-3">
          <mat-form-field appearance="outline" class="search-field">
              <mat-label>{{ 'nav.search' | transloco }}</mat-label>
            <input
              matInput
              #searchInput
              [value]="searchTerm()"
              (input)="onSearchInputChange(searchInput.value)"
              (keyup.enter)="searchBikes()"
              autocomplete="off">
            <mat-icon matSuffix (click)="searchBikes()" class="search-icon">search</mat-icon>
          </mat-form-field>
        </div>
      }
    </div>

    <div class="d-flex align-items-center ms-auto">
      <!-- Theme Toggle Button -->
      <button
        mat-icon-button
        (click)="toggleTheme()"
        [matTooltip]="currentTheme() === 'dark' ? 'Switch to Light Mode' : 'Switch to Dark Mode'"
        matTooltipPosition="below"
        [matTooltipShowDelay]="500"
        [matTooltipHideDelay]="100"
        class="theme-toggle me-2">
        <mat-icon>{{ currentTheme() === 'dark' ? 'light_mode' : 'dark_mode' }}</mat-icon>
      </button>

      @if (user()) {
        <div class="dropdown" dropdown>
          <div class="user-dropdown d-flex align-items-center"
               dropdownToggle
               [matTooltip]="'User Settings'"
               matTooltipPosition="below"
               [matTooltipShowDelay]="500"
               [matTooltipHideDelay]="100">
            <img [src]="user()?.photoUrl || './assets/user.png'"
              alt="{{user()?.knownAs}} profile photo"
              (error)="onImgError($event, user()?.photoUrl ||'/assets/user.png')">
            <mat-icon class="settings-icon ms-2">settings</mat-icon>
          </div>
          <div class="dropdown-menu" *dropdownMenu>
            <h6 class="dropdown-header">{{user()?.knownAs}}</h6>
            <div class="dropdown-divider"></div>
            <a routerLink="/member/profile/edit" class="dropdown-item">
              <mat-icon class="me-2">edit</mat-icon>
                {{ 'nav.editProfile' | transloco }}
            </a>
            <a class="dropdown-item" (click)="logout()">
              <mat-icon class="me-2">logout</mat-icon>
                {{ 'nav.logout' | transloco }}
            </a>
          </div>
        </div>
      }
      @else {
        <button
            mat-raised-button
            color="primary"
            class="hero-btn signup-btn--secondary"
            (click)="navigateToSignUp()">
              {{ 'nav.signup' | transloco }}
        </button>
        <button
          mat-stroked-button
          class="hero-btn signin-btn--secondary"
          (click)="navigateToLogin()">
            {{ 'nav.login' | transloco }}
        </button>
      }
      <div class="ms-3">
        <app-language-selector></app-language-selector>
      </div>
    </div>
  </div>
</nav>
