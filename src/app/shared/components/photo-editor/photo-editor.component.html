<div class="photo-editor-container" (click)="$event.stopPropagation()">
  <h3 mat-dialog-title>{{ 'photoEditor.title' | transloco }}</h3>
  <mat-dialog-content class="photo-dialog-content" (click)="$event.stopPropagation()">
    <div class="photo-upload-container">

      <h4>{{ 'photoEditor.select' | transloco }}</h4>

      <!-- Drag & Drop Zone with integrated file input -->
      <div class="file-upload-zone"
           [class.file-over]="hasBaseDropzoneOver()"
           (dragover)="onDragOver($event)"
           (dragleave)="onDragLeave($event)"
           (drop)="onFileDrop($event)">

        <div class="upload-content">
          <mat-icon class="upload-icon">cloud_upload</mat-icon>
          <h3 class="upload-title">{{ 'photoEditor.dragDrop' | transloco }}</h3>
          <p class="upload-subtitle">{{ 'photoEditor.or' | transloco }}</p>

          <!-- File input integrated in the drag zone -->
          <div class="file-input-container">
            <input #fileInput
                   id="photoFileInput"
                   type="file"
                   multiple
                   accept="image/*"
                   class="file-input-styled"
                   (change)="onFileSelected($event)"
                   [title]="('photoEditor.chooseFiles' | transloco)">
            <label for="photoFileInput" class="file-input-overlay">
              <mat-icon>upload_file</mat-icon>
              {{ 'photoEditor.chooseFiles' | transloco }}
            </label>
          </div>

          <p class="upload-formats">{{ 'photoEditor.formats' | transloco }}</p>
        </div>
      </div>
    @if (progress() > 0) {
      <div class="progress-container">
        <mat-progress-bar mode="determinate" [value]="progress()"></mat-progress-bar>
        <p>{{ progress() }}{{ 'photoEditor.progress' | transloco }}</p>
      </div>
    }

    @if (existingPhotos().length > 0) {
      <div class="existing-photos">
        <h5>{{ 'photoEditor.existing' | transloco }}: ({{ existingPhotos().length }} photos)</h5>
        <div class="row">
          @for (photo of existingPhotos(); track photo.id) {
            <div class="col-md-3 mb-3">
              <div class="card" style="border: 1px solid #ddd; border-radius: 8px;">
                <img [src]="photo.url" alt="photo" class="card-img-top uploaded-photo-preview"/>
                <div class="card-body p-2">
                  @if (photo.isMain) {
                    <div class="text-center mb-2">
                      <span class="badge badge-success">{{ 'photoEditor.mainPhoto' | transloco }}</span>
                    </div>
                  }
                  <div class="d-flex justify-content-between">
                    <button
                      mat-mini-fab
                      color="primary"
                      [disabled]="photo.isMain"
                      (click)="setMainPhoto(photo)"
                      title="Set as main photo">
                      <mat-icon>star</mat-icon>
                    </button>
                    <button
                      mat-mini-fab
                      color="warn"
                      [disabled]="photo.isMain"
                      (click)="deletePhoto(photo)"
                      title="Delete photo">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    }

  </div>
</mat-dialog-content>

  <mat-dialog-actions align="end" class="photo-dialog-actions">
    <button mat-stroked-button (click)="closeDialog()" color="warn">Cancel</button>
  </mat-dialog-actions>
</div> <!-- Close photo-editor-container -->
